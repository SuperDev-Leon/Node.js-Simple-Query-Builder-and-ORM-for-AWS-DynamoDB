box: wercker/nodejs
# Build definition
build:
  # The steps that will be executed on build
  steps:
    # A step that executes `npm install` command
    - npm-install
    # A custom script step, name value is used in the UI
    # and the code value contains the command that get executed
    - script:
        name: install java
        code: |
          if [ ! -d "$WERCKER_CACHE_DIR/jdk1.7.0_72" ] ; then wget -c -O "jdk-7u72-linux-x64.tar.gz" --no-check-certificate --no-cookies --header "Cookie: oraclelicense=accept-securebackup-cookie" "http://download.oracle.com/otn-pub/java/jdk/7u72-b14/jdk-7u72-linux-x64.tar.gz"; tar -zxvf jdk-7u72-linux-x64.tar.gz -C $WERCKER_CACHE_DIR; fi;
          sudo update-alternatives --install /usr/bin/java java $WERCKER_CACHE_DIR/jdk1.7.0_72/bin/java 10000
          sudo update-alternatives --set java $WERCKER_CACHE_DIR/jdk1.7.0_72/bin/java
    - script:
        name: launch dynamodb-local
        code: |
          cd ~/
          sudo wget http://dynamodb-local.s3-website-us-west-2.amazonaws.com/dynamodb_local_latest.tar.gz
          sudo tar zxvf ./dynamodb_local_latest.tar.gz
          sudo java -Djava.library.path=./DynamoDBLocal_lib -jar DynamoDBLocal.jar &
    - script:
        name: install mocha
        code: |
          sudo npm install -g mocha
    - npm-test
    - script:
        name: echo nodejs information
        code: |
          echo "node version $(node -v) running"
          echo "npm version $(npm -v) running"
